{% extends "base/base.html" %}
{% load to_jalali %}
{% load static %}
{% load plc_filters %}
{% block content %}

<div class="container-fluid px-4">
    {% if plc %}
    <!-- PLC Info Header -->
    <div class="plc-detail-header mb-4">
        <div class="plc-detail-right">
            <a href="/" class="btn-back">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                بازگشت
            </a>
            <div class="plc-detail-info">
                <div class="plc-status-dot online"></div>
                <span class="plc-detail-id">{{ plc.device_id }}</span>
                {% if plc.name %}
                <span class="plc-detail-name">{{ plc.name }}</span>
                {% endif %}
            </div>
        </div>
        <div class="plc-detail-left">
            <div class="live-indicator">
                <span class="live-dot"></span>
                <span>زنده</span>
            </div>
            <span class="last-update-label">آخرین بروزرسانی:</span>
            <span id="last_update_time">{% to_jalali plc.LastUpdate %}</span>
        </div>
    </div>

    <!-- Live Settings Section -->
    <div class="live-settings-single" id="settings_container" data-plc-id="{{ plc.id }}">
        {% if plc.setting %}
        <div class="settings-grid-large">
            {% for key, value in plc.setting.items %}
            
            <div class="setting-card" {% if key == 'st' and value == "m" %}style="background: linear-gradient(135deg, #f8f9fa 0%, #ffe9a6 100%);
            border: 1px solid #FFC107;"{% else %}{% endif %} data-key="{{ key }}">
                <div class="setting-card-key">{{ key|get_key_name }}</div>
                <div class="setting-card-value">{{ value }}</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-settings-large">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p>هنوز تنظیماتی دریافت نشده</p>
            <span>در انتظار دریافت داده از PLC...</span>
        </div>
        {% endif %}
    </div>
    {% else %}
    <!-- No PLC Selected -->
    <div class="no-plc-selected">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <h4>دستگاهی انتخاب نشده</h4>
        <p>لطفاً از داشبورد روی یک دستگاه کلیک کنید</p>
        <a href="/" class="btn-primary-link">بازگشت به داشبورد</a>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block Script %}
{% if plc %}
<script>
const PLC_ID = {{ plc.id }};
</script>
<script src="{% static 'plc_monitoring/js/live_settings.js' %}?version={{version}}"></script>
{% endif %}
{% endblock %}
